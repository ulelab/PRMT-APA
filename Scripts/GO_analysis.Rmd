---
title: "GO_analysis"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 1 Data preparation



```{r}
df <- read.csv('../Outputs/All_categories_DP_LS.csv')
gene_universe_df <- read.csv('../Outputs/Unfiltered_Formatted_All_Data_Sets_Final.csv')
```

```{r}
PRMT_genes <- unique(df[df$category=='PRMT_regulated',]$gene_ID) # interesting genes
gene_universe <- unique(gene_universe_df$gene_ID) #gene universe 
Ctrl_genes <- unique(df[df$category=='Control_sites',]$gene_ID) # interesting genes
Regulatable_genes <- unique(df[df$category=='Regulatable_sites',]$gene_ID) # interesting genes
```

Only symbol

```{r}
gene_universe_symbol <- unlist(strsplit(gene_universe,'_'))[seq(1,length(gene_universe)*2,2)]
```

#### Gene lists

```{r}
ds <-  data.frame(matrix(nrow = 5177, ncol =4))
colnames(ds) <- c('_BACKGROUND','PRMT_reg','Regulatable_sites','Control_sites')
ds$'_BACKGROUND' <- gene_universe_symbol
ds$PRMT_reg <- append(PRMT_genes, rep(NA,5177-length(PRMT_genes)))
ds$Regulatable_sites <- append(Regulatable_genes, rep(NA,5177-length(Regulatable_genes)))
ds$Control_sites <- append(Ctrl_genes, rep(NA,5177-length(Ctrl_genes)))
library(writexl)
write_xlsx(ds,'../GO_analysis/GO_list.xlsx')

```

# Metscape analysis

data

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(Rfast)
```

##multi list 


```{r}
ML_GO_MCODE <- read_csv('../GO_analysis/_FINAL_GO.csv')
```


```{r}
library(circlize)
library(ComplexHeatmap)

a <- ML_GO_MCODE[order(ML_GO_MCODE$Enrichment,decreasing = T),][1:50,]

b <- as.matrix(a[,4:6])
f1 <- colorRamp2(seq(min(a$LogP),-2, length = 3), c("Dark blue", "Magenta", "white"))

hm <- Heatmap(b,col =  f1, border = TRUE, name = "LogP")+rowAnnotation(foo=anno_text( paste(a$GO, a$Description) , gp = gpar(fontsize = 9))) 

draw(hm,column_title="Heatmap top50 enrichement",
   column_title_gp=grid::gpar(fontsize=16))
```

###single categories
```{r}
Reg <- ML_GO_MCODE %>% filter(ML_GO_MCODE$'_MEMBER_Regulatable_sites' == 1)
PRMT <- ML_GO_MCODE %>% filter(ML_GO_MCODE$'_MEMBER_PRMT_reg' == 1)
CTRL <- ML_GO_MCODE %>% filter(ML_GO_MCODE$'_MEMBER_Control_sites' == 1)
```

```{r}
Reg_ordered <- Reg[order(Reg$Enrichment,decreasing = T),][1:20,] %>% filter(LogP< -2)
plot_reg <- ggplot(Reg_ordered, aes(x=- LogP, y=reorder(paste(GO,Description),-LogP),colour=-LogP,size=Enrichment) )+scale_color_gradient2(high = "#DC143C")+
  xlab("-log(P)") +
ylab("GO")+
    geom_point()+theme_bw()+labs(colour="-log(P)")+ggtitle('GO results Regulatable')
plot_reg
```
```{r}
PRMT_ordered <- PRMT[order(PRMT$Enrichment,decreasing = T),][1:20,]%>% filter(LogP< -2)
plot_prmt <- ggplot(PRMT_ordered, aes(x=- LogP, y=reorder(paste(GO,Description),-LogP),colour=-LogP,size=Enrichment) )+scale_color_gradient2(high = "#DC143C")+
  xlab("-log(P)") +
ylab("GO")+
    geom_point()+theme_bw()+labs(colour="-log(P)")+ggtitle('GO results PRMT')
plot_prmt
```


```{r}
CTRL_ordered <- CTRL[order(CTRL$Enrichment,decreasing = T),][1:20,]%>% filter(LogP< -2)
plot_CTRL <- ggplot(CTRL_ordered, aes(x=- LogP, y=reorder(paste(GO,Description),-LogP),colour=-LogP,size=Enrichment) )+scale_color_gradient2(high = "#DC143C")+
  xlab("-log(P)") +
ylab("GO")+
    geom_point()+theme_bw()+labs(colour="-log(P)")+ggtitle('GO results Control sites')
plot_CTRL
```

#genes shortening /lengthening top

```{r}
genes_FGFR1 <- PRMT[PRMT$Description=='FGFRL1 modulation of FGFR1 signaling',]$Hits

a <- df[df$gene_ID %in% unlist(strsplit(genes_FGFR1,'\\|')),c(1:14,87:89)]
table(a$Effect,a$gene_ID)/2

```

FGF2:

https://link.springer.com/article/10.1007/s12672-018-0339-4
https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2819821/


SPRED1,2 

The protein encoded by this gene is a member of the Sprouty family of proteins and is phosphorylated by tyrosine kinase in response to several growth factors. The encoded protein can act as a homodimer or as a heterodimer with SPRED2 to regulate activation of the MAP kinase cascade. ùù

https://www.nature.com/articles/s41375-021-01423-x




